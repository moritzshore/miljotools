<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="English">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simplify Polygons • miljotools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simplify Polygons">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">miljotools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/metno_reanal.html">MET Nordic Reanalysis Dataset</a></li>
    <li><a class="dropdown-item" href="../articles/Norwegian_Soil_Classification.html">Soil Classification</a></li>
    <li><a class="dropdown-item" href="../articles/senorge.html">Accessing the SeNorge2018 dataset</a></li>
    <li><a class="dropdown-item" href="../articles/simplify-polygons.html">Simplify Polygons</a></li>
    <li><a class="dropdown-item" href="../articles/thermopluviograms.html">Thermopluviograms</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/moritzshore/miljotools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Simplify Polygons</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/moritzshore/miljotools/blob/HEAD/vignettes/simplify-polygons.Rmd" class="external-link"><code>vignettes/simplify-polygons.Rmd</code></a></small>
      <div class="d-none name"><code>simplify-polygons.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="simplify-polygons">Simplify Polygons<a class="anchor" aria-label="anchor" href="#simplify-polygons"></a>
</h2>
<p><img src="images/clipboard-1754363632.png"></p>
<p>QGIS has a useful tool to merge selected polygons with the nearest
polygon with the longest shared common boundary. This tool is quite
useful in simplifying maps that have many (too) small polygons which are
unnecessary to retain. I’ve always had to switch to QGIS to perform this
operation which is quite annoying since all my other GIS workflows are
in R. I haven’t found an R-package which can mimic this QGIS function so
I’ve implemented a version of it in R. This page guides you through how
to use it.</p>
<blockquote>
<p>Please, if you notice any errors or would like to improve the
function, let me know!</p>
</blockquote>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://moritzshore.github.io/miljotools/">miljotools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></code></pre></div>
<p>To get started, we need data. For this guide we will use the
pubically available NIBIO AR50 land use map for Ås, which I’ve
downloaded and hosted on a public NIBIO GitLab repository:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://gitlab.nibio.no/moritzshore/example-files/-/raw/main/simplify-geometries/aas_ar50.zip"</span>, destfile <span class="op">=</span> <span class="st">"aas_ar50.zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="st">"aas_ar50.zip"</span><span class="op">)</span></span>
<span><span class="va">lu_map</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span> <span class="st">"aas_ar50.shp"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lu_map</span><span class="op">[</span><span class="st">'arealtype'</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="simplify-polygons_files/figure-html/unnamed-chunk-2-1.png" class="r-plt" width="700"></p>
<p>This map contains about 30 polygons with less than 10 square meters
of area, some even with 0. Clearly these should be removed. To flag
these, we calculate their area in the attribute table</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lu_map</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># fix geometries</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_make_valid</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># select attributes of interest</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">lokalId</span>, <span class="va">arealtype</span>, <span class="va">skogbonite</span>, <span class="va">treslag</span>, <span class="va">jordbruk</span>, <span class="va">vegetasjon</span>, <span class="va">geometry</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># cast any multipolygons to polygons</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="st">"MULTIPOLYGON"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="st">"POLYGON"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># calculate the area</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>area <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Flag any polygons with an area of less than 10 square meters.</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>flag <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span>condition <span class="op">=</span> <span class="op">(</span><span class="va">area</span> <span class="op">&lt;</span>  <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">as_units</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"m^2"</span><span class="op">)</span><span class="op">)</span>, true <span class="op">=</span>  <span class="st">"flagged"</span>, false <span class="op">=</span>  <span class="st">"ok"</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">polygon_map</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in st_cast.sf(., "POLYGON"): repeating attributes for all</span></span>
<span><span class="co">## sub-geometries for which they may not be constant</span></span></code></pre>
<p>We shall also set which column we want to use as the
<code>type</code> column (in this case, <code>arealtype</code>). The
function will try to merge the flagged polygon with a polygon of the
same type first, before looking at other types. If this kind of
functionality is not needed, then you can set the <code>type</code>
column to an <code>ID</code> column which will ensure no neighbors of
the same type.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/simplify_polygons.html">simplify_polygons</a></span><span class="op">(</span></span>
<span>  polygon_map <span class="op">=</span> <span class="va">polygon_map</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"arealtype"</span>,</span>
<span>  interactive <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">polygon_map_simplified</span></span></code></pre></div>
<p>As we can see, the map now has 30 less polygons:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">polygon_map</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 854   9</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">polygon_map_simplified</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 824   9</span></span></code></pre>
<p>With the <code>verbose</code> and <code>interactive</code> parameters
disabled, we do not see what happens within the function. Enabling
<code>verbose</code> prints the decisions that the function makes and
tells you which polygons were merged into which. Enabling the
<code>interactive</code> parameter allows you to see in the viewer pane
what is going on and it also allows you to undone merges you disagree
with.</p>
<p>To make it more visible what the function does, we will now further
simplify any polygons with less then 100,000 m^2 of area:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">polygon_map_simplified</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>area <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Flag any polygons with an area of less than 10 square meters.</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>flag <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span>condition <span class="op">=</span> <span class="op">(</span><span class="va">area</span> <span class="op">&lt;</span>  <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">as_units</a></span><span class="op">(</span><span class="fl">100000</span>, <span class="st">"m^2"</span><span class="op">)</span><span class="op">)</span>, true <span class="op">=</span>  <span class="st">"flagged"</span>, false <span class="op">=</span>  <span class="st">"ok"</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">polygon_map_2</span></span>
<span></span>
<span><span class="fu"><a href="../reference/simplify_polygons.html">simplify_polygons</a></span><span class="op">(</span></span>
<span>  polygon_map <span class="op">=</span> <span class="va">polygon_map_2</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"arealtype"</span>,</span>
<span>  interactive <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">polygon_map_simplified2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">polygon_map_simplified2</span><span class="op">[</span><span class="st">'arealtype'</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="simplify-polygons_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" width="700"></p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Moritz Shore.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
